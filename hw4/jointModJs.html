<!DOCTYPE html>
<html>
<head>
    <title>Calcolo Distribuzione di Frequenza</title>
</head>
<body>
    <h1>Calcolo Distribuzione di Frequenza</h1>

    <!-- Spazi di input per le variabili -->
    <label for="backgroundInput">Background (Qualitativo):</label>
    <input type="text" id="backgroundInput"><br><br>

    <label for="ambitiousInput">Ambitious (Quantitativo Discreto):</label>
    <input type="number" id="ambitiousInput" min="0" max="5" step="1"><br><br>

    <label for="weightInputMin">Weight (Quantitativo Continuo - Minimo):</label>
    <input type="number" id="weightInputMin" step="0.01"><br><br>

    <label for="weightInputMax">Weight (Quantitativo Continuo - Massimo):</label>
    <input type="number" id="weightInputMax" step="0.01"><br><br>

    <button onclick="calcolaDistribuzione()">Calcola Distribuzione</button>

    <h2>Risultati:</h2>
    <div id="risultati"></div>

    <script>
        function calcolaDistribuzione() {
            // Ottieni i valori inseriti dall'utente
            var backgroundValue = document.getElementById("backgroundInput").value;
            var ambitiousValue = parseInt(document.getElementById("ambitiousInput").value);
            var weightMin = parseFloat(document.getElementById("weightInputMin").value);
            var weightMax = parseFloat(document.getElementById("weightInputMax").value);

            if (isNaN(ambitiousValue) || weightMin > weightMax) {
                alert("Assicurati di inserire valori validi.");
                return;
            }

            // Leggi il file TSV (dati.tsv) e calcola la distribuzione di frequenza
            fetch('dati.tsv')
                .then(response => response.text())
                .then(data => {
                    var lines = data.split('\n');
                    var header = lines[0].split('\t');
                    var backgroundIndex = header.indexOf('Background (degree)');
                    var ambitiousIndex = header.indexOf('Ambitious (0-5)');
                    var weightIndex = header.indexOf('weight');

                    var frequencyCount = {
                        background: {},
                        ambitious: {},
                        weight: {},
                        joint: {}
                    };

                    var totalRows = 0;

                    for (var i = 1; i < lines.length; i++) {
                        var values = lines[i].split('\t');
                        var background = values[backgroundIndex];
                        var ambitious = parseInt(values[ambitiousIndex]);
                        var weight = parseFloat(values[weightIndex]);

                        if (isNaN(ambitious) || isNaN(weight)) {
                            continue;
                        }

                        // Conta la frequenza assoluta per ciascuna variabile
                        if (background) {
                            if (!frequencyCount.background[background]) {
                                frequencyCount.background[background] = 0;
                            }
                            frequencyCount.background[background]++;
                        }

                        if (ambitious === ambitiousValue) {
                            frequencyCount.ambitious[ambitiousValue] = (frequencyCount.ambitious[ambitiousValue] || 0) + 1;
                        }

                        if (weight >= weightMin && weight <= weightMax) {
                            frequencyCount.weight[weight] = (frequencyCount.weight[weight] || 0) + 1;
                        }

                        // Calcola il joint tra "Background (degree)" e "Weight"
                        if (background && ambitious === ambitiousValue) {
                            var jointKey = background + " - Ambitious (" + ambitiousValue + ")";
                            if (!frequencyCount.joint[jointKey]) {
                                frequencyCount.joint[jointKey] = 0;
                            }
                            frequencyCount.joint[jointKey]++;
                        }

                        totalRows++;
                    }

                    // Visualizza i risultati
                    var risultati = document.getElementById("risultati");
                    risultati.innerHTML = "<h3>Frequenza Assoluta</h3>";
                    if (backgroundValue) {
                        risultati.innerHTML += "<p>Background (" + backgroundValue + "): " + (frequencyCount.background[backgroundValue] || 0) + " occorrenze</p>";
                    }
                    if (!isNaN(ambitiousValue)) {
                        risultati.innerHTML += "<p>Ambitious (" + ambitiousValue + "): " + (frequencyCount.ambitious[ambitiousValue] || 0) + " occorrenze</p>";
                    }

                    for (var i = weightMin; i <= weightMax; i += 0.01) {
                        risultati.innerHTML += "<p>Weight (" + i.toFixed(2) + "): " + (frequencyCount.weight[i] || 0) + " occorrenze</p>";
                    }

                    risultati.innerHTML += "<h3>Joint Frequenza Assoluta</h3>";
                    if (backgroundValue && !isNaN(ambitiousValue)) {
                        var jointKey = backgroundValue + " - Ambitious (" + ambitiousValue + ")";
                        risultati.innerHTML += "<p>" + jointKey + ": " + (frequencyCount.joint[jointKey] || 0) + " occorrenze</p>";
                    }
                })
                .catch(error => {
                    alert("Si Ã¨ verificato un errore nella lettura del file TSV.");
                    console.error(error);
                });
        }
    </script>
</body>
</html>
