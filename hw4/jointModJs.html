<!DOCTYPE html>
<html>
<head>
    <title>Calcolo Distribuzione di Frequenza</title>
</head>
<body>
    <h1>Calcolo Distribuzione di Frequenza</h1>

    <!-- Spazi di input per le variabili -->
    <label for="backgroundInput">Background (Qualitativo):</label>
    <input type="text" id="backgroundInput"><br><br>

    <label for="ambitiousInput">Ambitious (Quantitativo Discreto):</label>
    <input type="number" id="ambitiousInput" min="0" max="5" step="1"><br><br>

    <label for="rangeStart">Intervallo di Valori (Min):</label>
    <input type="number" id="rangeStart" step="0.01"><br><br>

    <label for="rangeEnd">Intervallo di Valori (Max):</label>
    <input type="number" id="rangeEnd" step="0.01"><br><br>

    <button onclick="calcolaDistribuzione()">Calcola Distribuzione</button>

    <h2>Risultati:</h2>
    <div id="risultati"></div>

    <script>
        function calcolaDistribuzione() {
            // Ottieni i valori inseriti dall'utente
            var backgroundValue = document.getElementById("backgroundInput").value;
            var ambitiousValue = parseInt(document.getElementById("ambitiousInput").value);
            var rangeStart = parseFloat(document.getElementById("rangeStart").value);
            var rangeEnd = parseFloat(document.getElementById("rangeEnd").value);

            // Assicurati che l'intervallo sia valido
            if (isNaN(rangeStart) || isNaN(rangeEnd) || rangeStart >= rangeEnd) {
                alert("L'intervallo di valori non Ã¨ valido.");
                return;
            }

            // Leggi il file TSV (dati.tsv) e calcola la distribuzione di frequenza
            fetch('dati.tsv')
                .then(response => response.text())
                .then(data => {
                    var lines = data.split('\n');
                    var header = lines[0].split('\t');
                    var backgroundIndex = header.indexOf('Background (degree)');
                    var ambitiousIndex = header.indexOf('Ambitious (0-5)');
                    var weightIndex = header.indexOf('weight');

                    var frequencyCount = {
                        background: {},
                        ambitious: {},
                    };

                    var weightFrequencies = {};

                    var jointFrequency = {};

                    var totalRows = 0;

                    for (var i = 1; i < lines.length; i++) {
                        var values = lines[i].split('\t');
                        var background = values[backgroundIndex];
                        var ambitious = parseInt(values[ambitiousIndex]);
                        var weight = parseFloat(values[weightIndex]);

                        if (
                            !isNaN(weight) &&
                            (weight >= rangeStart) &&
                            (weight <= rangeEnd)
                        ) {
                            // Conta la frequenza assoluta per ciascuna variabile nell'intervallo
                            if (background) {
                                if (!frequencyCount.background[background]) {
                                    frequencyCount.background[background] = 0;
                                }
                                frequencyCount.background[background]++;
                            }

                            if (!isNaN(ambitious)) {
                                if (!frequencyCount.ambitious[ambitious]) {
                                    frequencyCount.ambitious[ambitious] = 0;
                                }
                                frequencyCount.ambitious[ambitious]++;
                            }

                            // Conta la frequenza della variabile continua nell'intervallo
                            var weightKey = weight.toFixed(2);
                            if (!weightFrequencies[weightKey]) {
                                weightFrequencies[weightKey] = 0;
                            }
                            weightFrequencies[weightKey]++;

                            // Calcola il joint tra "Background" e "Weight" nell'intervallo
                            if (background) {
                                var jointKey = background + " - " + weightKey;
                                if (!jointFrequency[jointKey]) {
                                    jointFrequency[jointKey] = 0;
                                }
                                jointFrequency[jointKey]++;
                            }

                            totalRows++;
                        }
                    }

                    // Calcola frequenze relative per le variabili qualitative
                    var relativeFrequencies = {
                        background: {},
                        ambitious: {},
                    };

                    for (var key in frequencyCount.background) {
                        relativeFrequencies.background[key] = (frequencyCount.background[key] / totalRows).toFixed(2);
                    }

                    for (var key in frequencyCount.ambitious) {
                        relativeFrequencies.ambitious[key] = (frequencyCount.ambitious[key] / totalRows).toFixed(2);
                    }

                    // Calcola frequenze relative per la variabile continua
                    var weightRelativeFrequencies = {};

                    for (var key in weightFrequencies) {
                        weightRelativeFrequencies[key] = (weightFrequencies[key] / totalRows).toFixed(2);
                    }

                    // Visualizza i risultati
                    var risultati = document.getElementById("risultati");
                    risultati.innerHTML = "<h3>Frequenza Assoluta</h3>";
                    if (backgroundValue) {
                        risultati.innerHTML += "<p>Background (" + backgroundValue + "): " + (frequencyCount.background[backgroundValue] || 0) + " occorrenze</p>";
                    }
                    if (!isNaN(ambitiousValue)) {
                        risultati.innerHTML += "<p>Ambitious (" + ambitiousValue + "): " + (frequencyCount.ambitious[ambitiousValue] || 0) + " occorrenze</p>";
                    }

                    risultati.innerHTML += "<h3>Frequenza Relativa</h3>";
                    if (backgroundValue) {
                        risultati.innerHTML += "<p>Background (" + backgroundValue + "): " + (relativeFrequencies.background[backgroundValue] || 0) + "</p>";
                    }
                    if (!isNaN(ambitiousValue)) {
                        risultati.innerHTML += "<p>Ambitious (" + ambitiousValue + "): " + (relativeFrequencies.ambitious[ambitiousValue] || 0) + "</p>";
                    }

                    risultati.innerHTML += "<h3>Frequenza Relativa per Weight</h3>";
                    for (var key in weightRelativeFrequencies) {
                        risultati.innerHTML += "<p>Weight (" + key + "): " + weightRelativeFrequencies[key] + "</p>";
                    }

                    risultati.innerHTML += "<h3>Joint Frequenza Assoluta tra Background e Weight</h3>";
                    for (var jointKey in jointFrequency) {
                        risultati.innerHTML += "<p>" + jointKey + ": " + jointFrequency[jointKey] + " occorrenze</p>";
                    }
                });
        }
    </script>
</body>
</html>
