<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homework 5</title>
</head>
<body>
<h1>JS part HW5</h1>

<p>
    M servers are subject to attacks during a period of time T (for instance 1 year).
    Subdivide the interval T in N subinterval of size T/N and in each of this suppose that
    an attack can occur with probability Î» T/N.
    Simulate the attacks to the M servers and represent each of them with a line which
    makes jumps of 1 at each attack event.
</p>

<p>
    Using the same objects ("movable/resizable rectangle", histogram, etc.) of the previous homework 3
    draw vertically on the line chart the 2 histograms representing the distribution of the number
    of attacks at the end of the period and one internal istant for comparison.
</p>
    
<p>
    Study what happens asymptotically, for N large, and a number of systems M a sufficient to give shape to
    a simulated distribution. Make some personal considerations about the shape and the average of the distributions that you see.

    <form>
        <div class="mb-3">
          <label for="serverNumber" class="form-label">Enter server number</label>
          <input type="number" class="form-control" id="serverNumber">
        </div>
        <div class="mb-3">
          <label for="subIntervalNumber" class="form-label">Enter the number of subinterval</label>
          <input type="number" class="form-control" id="subIntervalNumber">
        </div>
        <div class="mb-3">
            <label for="lambda" class="form-label">Enter the number of attacks</label>
            <input type="number" class="form-control" id="lambda">
        </div>
        <button type="button" class="btn btn-primary" onclick="avviaAnimazione()">Calculate</button>
    </form>
    <p><b>LINK CODICE:</b></p>
            <ul>
                <!-- Primo link -->
                <li class="list-item"><a href="">JS CODE</a></li>
            </ul>
    <div class="container">
        <canvas id="myCanvas"></canvas>
    </div>
    
    <script>

        let M = 0;
        let N = 0;
        let lambda = 0;

        class Server{
            subIntervalNumber;
            lambda;
            attackList = [];

            constructor(subIntervalNumber, lambda){
                this.setAttack(subIntervalNumber, lambda);
            }

            setAttack(subIntervalNumber, lambda){
                this.lambda = lambda;
                this.subIntervalNumber = subIntervalNumber;
                const p = lambda / subIntervalNumber;
                for(let i = 0; i < lambda ; i++){
                    if(Math.random() > p){
                        this.attackList.push(1);
                    } else{
                        this.attackList.push(0);
                    }
                }
            }

        }

        class ServerList{
            serverList = [];
           
            constructor(subIntervalNumbers, lambda, serverNumber){
                this.setServerList(subIntervalNumbers, lambda, serverNumber);
            }

            setServerList(subIntervalNumber, lambda, serverNumber){
                for (let i = 0; i < serverNumber; i++) {
                    const server = new Server(subIntervalNumber, lambda);
                    this.serverList.push(server);
                }
            }

        }


        const container = document.querySelector('.container');
        const canvas = document.getElementById('myCanvas');
        const context = canvas.getContext('2d');

        let isResizing = false;

        container.addEventListener('mousedown', (e) => {
        if (e.target === container) {
        isResizing = true;
        initialX = e.clientX - container.offsetWidth;
        }
        });

        document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        container.style.width = (e.clientX - initialX) + 'px';
        canvas.width = container.offsetWidth;
        // Aggiorna il contenuto del canvas se necessario
        });

        document.addEventListener('mouseup', () => {
        isResizing = false;
        });
        var ctx = canvas.getContext('2d');
        canvas.width = 1000;
        canvas.height = 1000;
        var originX = 500;
        var originY = 500;

        function getRandomColor() {
        // Genera valori casuali per i canali R, G e B
        var r = Math.floor(Math.random() * 256); // Valore tra 0 e 255
        var g = Math.floor(Math.random() * 256);
        var b = Math.floor(Math.random() * 256);

        // Componi il colore in formato "rgb(r, g, b)"
        return 'rgb(' + r + ',' + g + ',' + b + ')';
        }

        function avviaAnimazione(){
            console.log('in event');
            M =  parseInt(document.getElementById("serverNumber").value, 10);
            
            N =  parseInt(document.getElementById("subIntervalNumber").value, 10);
            
            lambda = parseInt(document.getElementById("lambda").value, 10);
            
            if (N < 1 || M < 1) {
                alert("I numeri devono essere >= 1");
            } else{
               // const serverStart = new Server (N,lambda);
                const servers = new ServerList(N, lambda, M);
                ctx.beginPath();
                ctx.moveTo(originX, 0);
                ctx.lineTo(originX, canvas.height);
                ctx.moveTo(0, originY);
                ctx.lineTo(canvas.width, originY);
            
                for(let i = 1; i <= N; i++){
                    var xValue = i * 20;
                    var yValue = i * 20;
                    ctx.fillText(i, originX + xValue, originY + 12);
                    ctx.fillText(i, originX - 16, originY - yValue + 6);
                }
                ctx.stroke();
            
                var x = 0;
                var y = 0;
            
                let res = []; //keep track of last y value
                let xEnd = [];
                let yEnd = [];
                for(let i = 0; i < N; i++){
                    res[i] = 0;
                    xEnd[i] = 0;
                    yEnd[i] = 0;
                }
                // PROVE IMPORTANTI
                console.log(servers.serverList.length);
                console.log(servers.serverList[0]);
                console.log(servers.serverList[1]);
                let w = 0;
                const Elemento = servers.serverList[w];
                const lunghezzaPrimoElemento = Object.keys(Elemento).length;
                console.log("Lunghezza del primo elemento: " + lunghezzaPrimoElemento);
                // const prova = servers.serverList.attackList[0];
                //
                
                let lunghezzeMembri = []; // ARRAY CHE CONTIENE LA LUNGHEZZA DI serverList[i]

                for(let i = 0; i < servers.serverList.length; i++){
                    if (xEnd[i] === 0) {
                        ctx.beginPath();
                        ctx.moveTo(originX, originY);
                    }
                    for (let w = 0; w < servers.serverList.length; w++) {
                        const membro = servers.serverList[w];
                        const lunghezzaMembro = Object.keys(membro).length;
                        lunghezzeMembri.push(lunghezzaMembro);
                    }
                        console.log(lunghezzeMembri);
                        for(let j = 0; j < lunghezzeMembri[j]; j++){
                            if (servers.serverList[i].attackList[j] === 1) {
                                res[i]++
                            }
                            y = y + res[i];
                            xEnd[i] = x;
                            yEnd[i] = y;
                
                            var canvasX = originX + xEnd[i] * 20;
                            var canvasY = originY + yEnd[i] * 20;
                
                            ctx.lineTo(canvasX, canvasY);
                            ctx.strokeStyle = getRandomColor();
                            ctx.stroke();
                        }
                        lunghezzeMembri = []; 
                        y = 0;  
                }
            }
        }

    </script>
</body>
</html>